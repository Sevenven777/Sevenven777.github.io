<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#2.6.6'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>深入浅出Python多任务（线程，进程，协程） - Arianna_blog</title>
  
    <meta name="keywords" content="Python">
  
  
    <meta name="description" content="导入看一下下面的程序：">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" type="text/css" href="themes/volantis/source/css/matery.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  
  <link rel="shortcut icon" type='image/x-icon' href="/themes/volantis/source/img/favicon.ico">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow floatable blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h'>
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
            <i class='fab fa-atlassian'></i>
          
          
            Arianna <sup style="color:#3AA757"> 2020 </sup>
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-splotch fa-fw'></i>博客分类
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Django-Web/
                  
                  
                  
                    id="categoriesDjango-Web"
                  >
                  <i class='far fa-bookmark fa-fw'></i>Django-Web
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Algorithm/
                  
                  
                  
                    id="categoriesAlgorithm"
                  >
                  <i class='far fa-bookmark fa-fw'></i>Algorithm
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/data-structure/
                  
                  
                  
                    id="categoriesdata-structure"
                  >
                  <i class='far fa-bookmark fa-fw'></i>data-structure
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Python/
                  
                  
                  
                    id="categoriesPython"
                  >
                  <i class='far fa-bookmark fa-fw'></i>Python
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Hexo/
                  
                  
                  
                    id="categoriesHexo"
                  >
                  <i class='fas fa-heading fa-fw'></i>Hexo
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/C/
                  
                  
                  
                    id="categoriesC"
                  >
                  <i class='fab fa-cuttlefish fa-fw'></i>C/C++
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/MySQL/
                  
                  
                  
                    id="categoriesMySQL"
                  >
                  <i class='fas fa-database fa-fw'></i>MySQL
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Github/
                  
                  
                  
                    id="categoriesGithub"
                  >
                  <i class='fab fa-github fa-fw'></i>Github
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Others/
                  
                  
                  
                    id="categoriesOthers"
                  >
                  <i class='fas fa-cat fa-fw'></i>Others
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              
                <li>
                  <a class="flat-box">
                    <i class='fas fa-compact-disc fa-fw music fa-fw music'></i>背景音乐
                  </a>
                  <ul class="list-v">
                    <li>
                      <div class="aplayer-container">
                        

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='3175833810'
      list-folded='true'>
    </meting-js>
  


                      </div>
                    </li>
                  </ul>
                <li>
              
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="支持搜索中文、字母、数字" />
        </form>
      </div>

			<ul class='switcher nav-list-h'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-splotch fa-fw'></i>博客分类
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Django-Web/
                  
                  
                  
                    id="categoriesDjango-Web"
                  >
                  <i class='far fa-bookmark fa-fw'></i>Django-Web
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Algorithm/
                  
                  
                  
                    id="categoriesAlgorithm"
                  >
                  <i class='far fa-bookmark fa-fw'></i>Algorithm
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/data-structure/
                  
                  
                  
                    id="categoriesdata-structure"
                  >
                  <i class='far fa-bookmark fa-fw'></i>data-structure
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Python/
                  
                  
                  
                    id="categoriesPython"
                  >
                  <i class='far fa-bookmark fa-fw'></i>Python
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Hexo/
                  
                  
                  
                    id="categoriesHexo"
                  >
                  <i class='fas fa-heading fa-fw'></i>Hexo
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/C/
                  
                  
                  
                    id="categoriesC"
                  >
                  <i class='fab fa-cuttlefish fa-fw'></i>C/C++
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/MySQL/
                  
                  
                  
                    id="categoriesMySQL"
                  >
                  <i class='fas fa-database fa-fw'></i>MySQL
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Github/
                  
                  
                  
                    id="categoriesGithub"
                  >
                  <i class='fab fa-github fa-fw'></i>Github
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="flat-box" href=/categories/Others/
                  
                  
                  
                    id="categoriesOthers"
                  >
                  <i class='fas fa-cat fa-fw'></i>Others
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>

</header>

<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box reveal blur article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h1 class="title">
    <a href="/2020/08/12/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAPython%E5%A4%9A%E4%BB%BB%E5%8A%A1%EF%BC%88%E7%BA%BF%E7%A8%8B%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B%EF%BC%89/">
      深入浅出Python多任务（线程，进程，协程）
    </a>
  </h1>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a href="https://sevenven777.github.io/" target="_blank" rel="nofollow noopener">
    <img src="https://i.loli.net/2020/05/09/594pXz6CViWuAy3.jpg">
    <p>Arianna Watson</p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/Python/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>Python</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Aug 12, 2020</p>
  </a>
</div>

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>看一下下面的程序：</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">def sing():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;sing....&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dance():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;dancing...&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    sing()</span><br><span class="line">    dance()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行这个程序，输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br></pre></td></tr></table></figure>
<p>一共花费了十秒。</p>
<p>修改程序为多任务的程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">def sing():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;sing....&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dance():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;dancing...&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    t1 &#x3D; threading.Thread(target&#x3D;sing)</span><br><span class="line">    t2 &#x3D; threading.Thread(target&#x3D;dance)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行这个程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python test02.py</span><br><span class="line">sing....</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">sing....</span><br><span class="line">dancing...</span><br><span class="line">sing....</span><br><span class="line">dancing...</span><br><span class="line">sing....</span><br><span class="line">dancing...</span><br><span class="line">sing....</span><br></pre></td></tr></table></figure>
<p>所谓的多任务，就是同时可以做多件事情。</p>
<p>一台计算机同时可以做多少件事情，是由CPU觉得的，如果CPU的双核的，说明同时可以做两件事情，如果是四核的，就可以同时做四件事情。</p>
<p>如果计算机是单核的，怎么实现多任务？</p>
<p>一个比较好理解的办法是，时间片轮转，比如当前有四个程序，CPU是一核的，那么就让第一个程序先执行0.00001s，然后让下一个程序再执行0.00001s，这样每个程序都执行了0.00001s之后，再来执行第一个程序。因为人是察觉不到0.0001s的切换的，所以在我们看来，程序就像在“一起”执行一样，这样的多任务，叫并发，并发是加到多任务。</p>
<p>如果计算机是双核的，现在有两个程序，那么这两个程序可以同时执行，这样真的一起同时在执行叫做“并行”，并行是真的多任务。</p>
<h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><p>那么怎样才能让Python程序完成多任务呢。</p>
<p>线程就是实现多任务的一种手段。</p>
<h4 id="1-threading模块"><a href="#1-threading模块" class="headerlink" title="1.threading模块"></a>1.threading模块</h4><p>在Python中有一个模块是threading，这个模块中有一个类是Thread，用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def test():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;123456&quot;)</span><br><span class="line"></span><br><span class="line"># target接收的是函数名，不是函数的调用</span><br><span class="line">t1 &#x3D; threading.Thread(target &#x3D; test)</span><br><span class="line">t1.start()</span><br></pre></td></tr></table></figure>
<p>类名+“（）”就创建了一个对象，这个对象就是之后要启动的线程。</p>
<p>当t1.start()的时候，这个线程就真正开始创建并被执行。</p>
<p>还是这个程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">def sing():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;sing....&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dance():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;dancing...&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    t1 &#x3D; threading.Thread(target&#x3D;sing)</span><br><span class="line">    t2 &#x3D; threading.Thread(target&#x3D;dance)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>主线程从上往下执行，当走到def sing的时候，不进入函数执行，因为这是一个函数的定义，继续往下走，到dance的时候也不执行，走到main也不执行，遇到<code>if __name__ == &quot;__main__&quot;:</code>执行调用里面的main()，然后进入main这个函数。</p>
<p><code>t1 = threading.Thread(target=sing)</code>的时候，创建了一个对象，把它赋给了t1，遇到<code>t2 = threading.Thread(target=dance)</code>的时候，创建了一个对象，把它赋给了t2。</p>
<p>当主线程运行到<code>t1.start()</code>的时候，主线程创建了一个子线程，这个子线程去执行sing函数，主线程继续往下执行，当遇到<code>t2.start()</code>的时候，主线程创建另外一个子线程，这个子线程去执行dance函数。</p>
<p>主线程往下就没有执行的代码了，这时候主线程会等待子线程执行结束，然后主线程再结束。</p>
<h4 id="2-查看线程的数量"><a href="#2-查看线程的数量" class="headerlink" title="2.查看线程的数量"></a>2.查看线程的数量</h4><p>threading模块中有一个有一个方法是enumerate，只要调用threading.enumerate()他的返回值就是一个列表，这个列表中的元素就是主线程和子线程。</p>
<p>修改程序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line"></span><br><span class="line">def sing():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;sing....&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dance():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;dancing...&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    t1 &#x3D; threading.Thread(target&#x3D;sing)</span><br><span class="line">    t2 &#x3D; threading.Thread(target&#x3D;dance)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    print(threading.enumerate())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>然后执行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">dancing...</span><br><span class="line">[&lt;_MainThread(MainThread, started 9080)&gt;]</span><br></pre></td></tr></table></figure>
<p>发现打印出来的线程里面只有一个是主线程，没有其他两个子线程。</p>
<p>原因是当主线程走到t1.start()的时候创建了一个子线程，在t2.start()的时候又创建了一个子线程，然后主线程继续往下走，走到print，这时候这个程序有三个线程，又因为这三个线程都是没有延迟的，所以先让哪个线程执行就取决于操作系统，操作系统在调度这三个线程的时候，让谁先执行是不确定的。所以线程的执行是没有先后顺序的。</p>
<p>如果想让某个线程先执行可以采用一个方法就是让其他的线程延时。</p>
<p>想要看到系统什么时刻有哪几个线程在运行，方法如下：</p>
<p>修改代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def sing():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;sing....第%d秒--&quot; % i)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def dance():</span><br><span class="line">    for i in range(10):</span><br><span class="line">        print(&quot;dancing...第%d秒--&quot; % i)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    t1 &#x3D; threading.Thread(target&#x3D;sing)</span><br><span class="line">    t2 &#x3D; threading.Thread(target&#x3D;dance)</span><br><span class="line"></span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">    	print(threading.enumerate())</span><br><span class="line">    	time.sleep(1)</span><br><span class="line">    	if len(threading.enumerate()) &lt;&#x3D; 1:</span><br><span class="line">    		break</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>循环打印当前系统中的线程，如果当前系统中只剩下一个线程，就是主线程，那么就退出循环。</p>
<p>执行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">sing....▒▒0▒▒--</span><br><span class="line">dancing...▒▒0▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-1, started 12124)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒1▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-1, started 12124)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">sing....▒▒1▒▒--</span><br><span class="line">sing....▒▒2▒▒--</span><br><span class="line">dancing...▒▒2▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-1, started 12124)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒3▒▒--</span><br><span class="line">sing....▒▒3▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-1, started 12124)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒4▒▒--</span><br><span class="line">sing....▒▒4▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-1, started 12124)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒5▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒6▒▒--</span><br><span class="line">dancing...▒▒7▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒8▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br><span class="line">dancing...▒▒9▒▒--</span><br><span class="line">[&lt;_MainThread(MainThread, started 14184)&gt;, &lt;Thread(Thread-2, started 16304)&gt;]</span><br></pre></td></tr></table></figure>
<p>可以看到每一秒钟程序的线程，前五秒是三个线程，到了第五秒，程序里面有两个线程，因为循环5次，每次休眠1秒的sing线程结束了，然后到了第十秒，第二个子线程也执行完了，程序中就只剩一个主线程，所以退出循环不打印了。这时候主线程也结束，程序结束。</p>
<p>所以如果创建Thread来执行函数，当这个函数执行完，这个子线程也就结束了。</p>
<p>主线程结束，程序就结束了。所以主线程会等待所有的子线程执行结束再结束。</p>
<h4 id="3-子线程是什么时候被创建的，什么时候被执行的"><a href="#3-子线程是什么时候被创建的，什么时候被执行的" class="headerlink" title="3.子线程是什么时候被创建的，什么时候被执行的"></a>3.子线程是什么时候被创建的，什么时候被执行的</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import threading</span><br><span class="line"></span><br><span class="line">In [2]: def test():</span><br><span class="line">   ...:     print(&quot;------1--------&quot;)</span><br><span class="line">   ...:</span><br><span class="line"></span><br><span class="line">In [3]: t1 &#x3D; threading.Thread(target&#x3D;test)</span><br><span class="line"></span><br><span class="line">In [4]: t1.start()</span><br><span class="line">------1--------</span><br></pre></td></tr></table></figure>
<p>当t1被赋值的时候，test函数并没有被调用没有被执行，而是start的时候test函数才被执行，所以说明线程是在被调用的时候才执行。</p>
<p>那线程是什么时候被创建的?</p>
<p>是<code>t1 = threading.Thread(target=test)</code>的时候被创建的，还是<code>t1.start()</code>的时候被创建的？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def sing():</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&quot;sing....&quot;)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	print(threading.enumerate())</span><br><span class="line">    t1 &#x3D; threading.Thread(target&#x3D;sing)</span><br><span class="line">    print(threading.enumerate())</span><br><span class="line">    t1.start()</span><br><span class="line">    print(threading.enumerate())</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>在<code>t1 = threading.Thread(target=sing)</code>之前查看当前程序有多少线程，在<code>t1 = threading.Thread(target=sing)</code>之后查看当前程序有多少线程，在start之后再查看一次。</p>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">[&lt;_MainThread(MainThread, started 11772)&gt;]</span><br><span class="line">[&lt;_MainThread(MainThread, started 11772)&gt;]</span><br><span class="line">sing....</span><br><span class="line">[&lt;_MainThread(MainThread, started 11772)&gt;, &lt;Thread(Thread-1, started 11456)&gt;]</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br><span class="line">sing....</span><br></pre></td></tr></table></figure>
<p>在start前打印的两次线程中，都没有线程Thread-1，说明当t1.start()的时候，线程才真正被创建和执行。</p>
<p>所以当调用Thread的时候，不会创建线程，当调用Thread创建出来的实例对象的start方法的时候线程才会被创建，以及开始运行线程。</p>
<p><strong>总结：</strong></p>
<ul>
<li>如果想完成多任务，就可以通过Thread创建一个<strong>对象</strong>，这个对象一调用start，子线程就会被创建和执行，这个对象执行什么就看传递的target是哪个函数名。当这个被执行的函数结束了，这个子线程就结束了。</li>
<li>线程真正创建是start，真正结束是函数结束。</li>
<li>多个线程被创建之后，执行顺序是不确定的，执行顺序取决于操作系统，如果想指定执行的先后顺序，可以通过延时来实现。</li>
<li>主线程最后结束，因为主线程结束程序就结束了。</li>
</ul>
<p>创建Thread对象这个过程可以理解为线程的准备工作。</p>
<h4 id="4-target也可以是一个类"><a href="#4-target也可以是一个类" class="headerlink" title="4.target也可以是一个类"></a>4.target也可以是一个类</h4><p>当target是一个类的时候，写法就有变化了。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">class MyThread(threading.Thread):</span><br><span class="line">	def run(self):</span><br><span class="line">		for i in range(5):</span><br><span class="line">			print(i)</span><br><span class="line">			time.sleep(i)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t &#x3D; MyThread()</span><br><span class="line">	t.start()</span><br><span class="line">	</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>用类来创建线程的时候，直接把类实例化一个对象传给t就可以，调用的时候还是t.start()就可以。</p>
<p>这个类必须要继承<code>threading.Thread</code>，这个类里必须定义run方法，线程start之后，会自动调用run方法，执行run里面的代码。</p>
<p>类中没有定义start方法，这个start方法是继承自Thread的方法。</p>
<p>所以创建线程有两种方式：</p>
<ol>
<li><code>t1 = threading.Thread(target=函数名)</code></li>
</ol>
<ul>
<li>函数里面的代码是什么，线程就去执行什么</li>
</ul>
<ol start="2">
<li>用类<br>定义一个类，这个类必须继承<code>threading.Thread</code>，而且这个类必须实现run方法，这个run方法中写了什么，线程就去执行什么。</li>
</ol>
<p>这种方式适合一个线程做的事情比较复杂，而且涉及多个函数，一般就把这些函数封装成一个类。</p>
<p>相比较而言，函数的方式更加简单。</p>
<p>如果类中还有其他函数想要在线程执行的适合执行，那么这个函数的调用可以写在run函数中。</p>
<h4 id="5-多个线程之间共享全局变量"><a href="#5-多个线程之间共享全局变量" class="headerlink" title="5.多个线程之间共享全局变量"></a>5.多个线程之间共享全局变量</h4><p>修改全局变量前提：</p>
<blockquote>
<p>在一个函数中，对全局变量进行修改的时候，到底是否需要使用global取决于是否对变量的指向进行了修改。</p>
<ul>
<li>如果进行了修改，即让全局变量指向了一个新的地方，那么必须使用global</li>
<li>如果仅仅是修改了全局变量指向空间的数据，就不必须使用global<br>能不能修改还看全局变量是否可变，数字、字符串、元组不可变</li>
</ul>
</blockquote>
<p>例如，如果全局变量是数字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [9]: num &#x3D; 100</span><br><span class="line"></span><br><span class="line">In [10]: def test():</span><br><span class="line">    ...:     global num</span><br><span class="line">    ...:     num +&#x3D; 100</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [11]: print(num)</span><br><span class="line">100</span><br><span class="line"></span><br><span class="line">In [12]: test()</span><br><span class="line"></span><br><span class="line">In [13]: print(num)</span><br><span class="line">200</span><br></pre></td></tr></table></figure>
<p>此时修改全局变量就要加global。</p>
<p>如果不加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [16]: num &#x3D; 100</span><br><span class="line"></span><br><span class="line">In [17]: def test():</span><br><span class="line">    ...:     num +&#x3D; 100</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [18]: print(num)</span><br><span class="line">100</span><br><span class="line"></span><br><span class="line">In [19]: test()</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">UnboundLocalError                         Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-19-fbd55f77ab7c&gt; in &lt;module&gt;</span><br><span class="line">----&gt; 1 test()</span><br><span class="line"></span><br><span class="line">&lt;ipython-input-17-fabd8b626a8d&gt; in test()</span><br><span class="line">      1 def test():</span><br><span class="line">----&gt; 2     num +&#x3D; 100</span><br><span class="line">      3</span><br><span class="line"></span><br><span class="line">UnboundLocalError: local variable &#39;num&#39; referenced before assignment</span><br><span class="line"></span><br><span class="line">In [20]: print(num)</span><br><span class="line">100</span><br></pre></td></tr></table></figure>
<p>如果全局变量是可变对象，不修改它的指向：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [22]: nums &#x3D; [11,22]</span><br><span class="line"></span><br><span class="line">In [23]: def test():</span><br><span class="line">    ...:     nums.append(33)</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [24]: print(nums)</span><br><span class="line">[11, 22]</span><br><span class="line"></span><br><span class="line">In [25]: test()</span><br><span class="line"></span><br><span class="line">In [26]: print(nums)</span><br><span class="line">[11, 22, 33]</span><br></pre></td></tr></table></figure>
<p>如果全局变量是可变对象，修改它的指向：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [28]: nums &#x3D; [11,22]</span><br><span class="line"></span><br><span class="line">In [29]: def test():</span><br><span class="line">    ...:     nums +&#x3D; [33]</span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [30]: print(nums)</span><br><span class="line">[11, 22]</span><br><span class="line"></span><br><span class="line">In [31]: test()</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">UnboundLocalError                         Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-31-fbd55f77ab7c&gt; in &lt;module&gt;</span><br><span class="line">----&gt; 1 test()</span><br><span class="line"></span><br><span class="line">&lt;ipython-input-29-8d9294d083c5&gt; in test()</span><br><span class="line">      1 def test():</span><br><span class="line">----&gt; 2     nums +&#x3D; [33]</span><br><span class="line">      3</span><br><span class="line"></span><br><span class="line">UnboundLocalError: local variable &#39;nums&#39; referenced before assignment</span><br><span class="line"></span><br><span class="line">In [32]: print(nums)</span><br><span class="line">[11, 22]</span><br></pre></td></tr></table></figure>
<p><strong>验证线程之间是共享全局变量的方法：</strong></p>
<p>1.创建两个线程，一个用来修改全局变量，一个在修改完全局变量后打印这个全局变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 全局变量</span><br><span class="line">num &#x3D; 100</span><br><span class="line"></span><br><span class="line">def test01():</span><br><span class="line">	global num</span><br><span class="line">	num +&#x3D; 100</span><br><span class="line">	print(&quot;test01:   num &#x3D; %d&quot; % num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test02():</span><br><span class="line">	print(&quot;test02:   num &#x3D; %d&quot; % num)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;test01)</span><br><span class="line">	t2 &#x3D; threading.Thread(target&#x3D;test02)</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	time.sleep(1)</span><br><span class="line">	t2.start()</span><br><span class="line">	time.sleep(1)</span><br><span class="line"></span><br><span class="line">	print(&quot;main thread:     num &#x3D; %d&quot; % num)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   num &#x3D; 200</span><br><span class="line">test02:   num &#x3D; 200</span><br><span class="line">main thread:     num &#x3D; 200</span><br></pre></td></tr></table></figure>
<p>说明线程之间是共享全局变量的。</p>
<p><strong>2.把全局变量当作参数传给函数</strong></p>
<p>修改程序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def test01(tmp1):</span><br><span class="line">	tmp1.append(33)</span><br><span class="line">	print(&quot;test01:   tmp &#x3D; %s&quot; % str(tmp1))</span><br><span class="line"></span><br><span class="line">def test02(tmp2):</span><br><span class="line">	print(&quot;test02:   tmp &#x3D; %s&quot; % str(tmp2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nums &#x3D; [11,22]</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;test01,args&#x3D;(nums,))</span><br><span class="line">	t2 &#x3D; threading.Thread(target&#x3D;test02,args&#x3D;(nums,))</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	time.sleep(1)</span><br><span class="line">	t2.start()</span><br><span class="line">	time.sleep(1)</span><br><span class="line"></span><br><span class="line">	print(&quot;main thread:     nums &#x3D; %s&quot; % str(nums))</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>args是要传递给函数的数据，这个数据必须是个<strong>元组</strong>，就是需要写<strong>括号</strong>，可以传递多个参数，<strong>参数最后多加一个逗号“,”，不然会报错</strong>。</p>
</blockquote>
<p>运行这个程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   tmp &#x3D; [11, 22, 33]</span><br><span class="line">test02:   tmp &#x3D; [11, 22, 33]</span><br><span class="line">main thread:     nums &#x3D; [11, 22, 33]</span><br></pre></td></tr></table></figure>
<h4 id="6-共享全局变量可能遇到的问题：资源竞争"><a href="#6-共享全局变量可能遇到的问题：资源竞争" class="headerlink" title="6.共享全局变量可能遇到的问题：资源竞争"></a>6.共享全局变量可能遇到的问题：资源竞争</h4><p><strong>可能遇到资源竞争的问题。</strong></p>
<p>定义两个函数，他们都用来把全局变量加1，循环100次，这样如果这两个函数都执行完，如果全局变量一开始是0，那么执行完两个函数就应该是200。</p>
<p>程序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 全局变量</span><br><span class="line">global_num &#x3D; 0</span><br><span class="line"></span><br><span class="line">def test01(num):</span><br><span class="line">	global global_num</span><br><span class="line">	for i in range(num):</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">	print(&quot;test01:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test02(num):</span><br><span class="line">	global global_num</span><br><span class="line">	for i in range(num):</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">	print(&quot;test02:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;test01,args&#x3D;(100,))</span><br><span class="line">	t2 &#x3D; threading.Thread(target&#x3D;test02,args&#x3D;(100,))</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	t2.start()</span><br><span class="line"></span><br><span class="line">	time.sleep(5)</span><br><span class="line">	print(&quot;main thread:     num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   num &#x3D; 100</span><br><span class="line">test02:   num &#x3D; 200</span><br><span class="line">main thread:     num &#x3D; 200</span><br></pre></td></tr></table></figure>
<p>这时候执行结果是正确的。</p>
<p>如果不是循环100次，而是循环1000000次，那么结果应该是2000000。</p>
<p>修改程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 全局变量</span><br><span class="line">global_num &#x3D; 0</span><br><span class="line"></span><br><span class="line">def test01(num):</span><br><span class="line">	global global_num</span><br><span class="line">	for i in range(num):</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">	print(&quot;test01:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test02(num):</span><br><span class="line">	global global_num</span><br><span class="line">	for i in range(num):</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">	print(&quot;test02:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;test01,args&#x3D;(1000000,))</span><br><span class="line">	t2 &#x3D; threading.Thread(target&#x3D;test02,args&#x3D;(1000000,))</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	t2.start()</span><br><span class="line"></span><br><span class="line">	time.sleep(5)</span><br><span class="line">	print(&quot;main thread:     num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   num &#x3D; 1132201</span><br><span class="line">test02:   num &#x3D; 1402099</span><br><span class="line">main thread:     num &#x3D; 1402099</span><br></pre></td></tr></table></figure>
<p>这时候执行结果就出错了。</p>
<p>因为global_num += 1这个语句在执行的时候，会分成几步，1.先取到global_num的值。2.把这个值加一。3.把这个值存起来。</p>
<p>操作系统如果使用了时间片轮转法，在global_num等于0的时候，线程1取到了0这个值，然后把它加一，变成了1，这时候操作系统去执行线程2，取到的值还是0，把它加一，然后存储起来，这时候global的值为1，操作系统再去执行线程1，线程1把它计算的1保存，这时候global的值依旧为1，所以虽然global的值被计算了两次，但是实际得到的结果是错误的。</p>
<p>所以如果多线程共享全局变量，而且同一时刻都在操作全局变量，就可能出现问题，这就是资源竞争。</p>
<h4 id="7-解决资源竞争问题"><a href="#7-解决资源竞争问题" class="headerlink" title="7.解决资源竞争问题"></a>7.解决资源竞争问题</h4><p>可以通过线程同步来解决问题。</p>
<blockquote>
<p>同步就是协同步调，协同就是一个先执行，再执行另一个，互相配合着执行。</p>
</blockquote>
<p>同步可以用互斥锁来实现。</p>
<blockquote>
<p>互斥锁就是当线程1要修改全局变量之前，先把这个全局变量上锁，这样其他的线程就无法修改这个数据，当前线程1用完这个全局变量后，再把锁解开。</p>
</blockquote>
<p>互斥锁的创建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建所</span><br><span class="line">mutex &#x3D; threading.Lock()</span><br><span class="line"></span><br><span class="line"># 锁定</span><br><span class="line">mutex.acquire()</span><br><span class="line"></span><br><span class="line"># 释放</span><br><span class="line">mutex.release()</span><br></pre></td></tr></table></figure>
<p>如果一个数据是没有上锁的，那么acquire不会堵塞。</p>
<p>如果这个数据已经被其他线程锁定了，那么此时再上锁（acquire），会堵塞，当其他线程解锁之后，当前的线程才能上锁。</p>
<p><strong>互斥锁解决资源竞争问题：</strong></p>
<p>创建一个全局变量是锁：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 全局变量</span><br><span class="line">global_num &#x3D; 0</span><br><span class="line"></span><br><span class="line">def test01(num):</span><br><span class="line">	global global_num</span><br><span class="line">	# 上锁</span><br><span class="line">	mutex.acquire()</span><br><span class="line">	for i in range(num):</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">	mutex.release()</span><br><span class="line">	print(&quot;test01:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test02(num):</span><br><span class="line">	global global_num</span><br><span class="line">	mutex.acquire()</span><br><span class="line">	for i in range(num):</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">	mutex.release()</span><br><span class="line">	print(&quot;test02:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建一个互斥锁，默认没有上锁</span><br><span class="line">mutex &#x3D; threading.Lock()</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;test01,args&#x3D;(1000000,))</span><br><span class="line">	t2 &#x3D; threading.Thread(target&#x3D;test02,args&#x3D;(1000000,))</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	t2.start()</span><br><span class="line"></span><br><span class="line">	time.sleep(5)</span><br><span class="line">	print(&quot;main thread:     num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   num &#x3D; 1000000</span><br><span class="line">test02:   num &#x3D; 2000000</span><br><span class="line">main thread:     num &#x3D; 2000000</span><br></pre></td></tr></table></figure>
<p>这时候结果是正确的，线程1和线程2不一定哪个线程会先抢到这把锁，如果一个线程给全局变量上锁了，另一个线程只能等待这个线程解锁，才能上锁，对全局变量进行操作。</p>
<p>上锁有一个原则是锁定的代码越少越好，所以修改程序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 全局变量</span><br><span class="line">global_num &#x3D; 0</span><br><span class="line"></span><br><span class="line">def test01(num):</span><br><span class="line">	global global_num</span><br><span class="line">	for i in range(num):</span><br><span class="line">		mutex.acquire()</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">		mutex.release()</span><br><span class="line">	print(&quot;test01:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test02(num):</span><br><span class="line">	global global_num</span><br><span class="line">	for i in range(num):</span><br><span class="line">		mutex.acquire()</span><br><span class="line">		global_num +&#x3D; 1</span><br><span class="line">		mutex.release()</span><br><span class="line">	print(&quot;test02:   num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建一个互斥锁，默认没有上锁</span><br><span class="line">mutex &#x3D; threading.Lock()</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; threading.Thread(target&#x3D;test01,args&#x3D;(1000000,))</span><br><span class="line">	t2 &#x3D; threading.Thread(target&#x3D;test02,args&#x3D;(1000000,))</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	t2.start()</span><br><span class="line"></span><br><span class="line">	time.sleep(5)</span><br><span class="line">	print(&quot;main thread:     num &#x3D; %d&quot; % global_num)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>执行程序：</p>
<p>执行第一遍：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   num &#x3D; 1921277</span><br><span class="line">test02:   num &#x3D; 2000000</span><br><span class="line">main thread:     num &#x3D; 2000000</span><br></pre></td></tr></table></figure>
<p>执行第二遍：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test01.py</span><br><span class="line">test01:   num &#x3D; 1884133</span><br><span class="line">test02:   num &#x3D; 2000000</span><br><span class="line">main thread:     num &#x3D; 2000000</span><br></pre></td></tr></table></figure>
<p>这是因为，因为加锁只加了global_num += 1这一行代码，所以有可能出现在线程1执行完之前，线程1给global_num 加了一些值，线程2也给global加了一些值，所以到线程1执行完之前，global被加了超过1000000次，所以有了这样的结果。</p>
<h4 id="8-互斥锁带来的死锁问题"><a href="#8-互斥锁带来的死锁问题" class="headerlink" title="8.互斥锁带来的死锁问题"></a>8.互斥锁带来的死锁问题</h4><p>如果有两个资源，资源A和资源B，有两个线程，线程1和线程2。</p>
<p>线程1要先使用资源A，然后使用资源B，线程2要先使用资源B，再使用资源A。</p>
<p>如果线程1先给A上了锁，然后使用了A，进行一些操作，与此同时，线程2给B上了锁，进行了一些操作。</p>
<p>这时候线程1要使用资源B，发现资源B被上锁了，那线程1就等待线程2解锁。</p>
<p>线程2要使用资源A，发现资源A被上锁了，那线程2就等待线程1解锁。</p>
<p>两个线程就一直等待互相释放资源，这种现象就是死锁。</p>
<p><strong>如何解决死锁问题</strong>：</p>
<p>1.银行家算法：设计程序时尽量避免死锁</p>
<p>2.添加超时时间</p>
<p><strong>银行家算法：</strong></p>
<p>如果一个银行家有10块钱，有三个客户要贷款，客户A要贷款9块钱，客户B要贷款3块钱，客户C要贷款8块钱。</p>
<p>那么这个时候，银行家手里的钱不足以让三个客户都拿到贷款。</p>
<p>这个时候，先借给客户A 2块钱，借给客户B 2块钱，借给客户C 4块钱，这时候银行家手里还有2块钱。</p>
<table>
<thead>
<tr>
<th>银行家</th>
<th>客户A(9)</th>
<th>客户B(3)</th>
<th>客户C(8)</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>这时候银行家手里的2块钱借给客户B 1块钱，告诉其他的客户剩下的前过几天再借给他。</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>银行家</th>
<th>客户A(9)</th>
<th>客户B(3)</th>
<th>客户C(8)</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3（满足）</td>
<td>4</td>
</tr>
<tr>
<td>和客户B约定好还钱的时间，当客户B归还了3块钱的时候，银行家手里就有了4块钱，把这4块钱再借给客户C。</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>银行家</th>
<th>客户A(9)</th>
<th>客户B(3)</th>
<th>客户C(8)</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3（满足）</td>
<td>4</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>（已归还）</td>
<td>4</td>
</tr>
<tr>
<td>0</td>
<td>2</td>
<td>（已归还）</td>
<td>8</td>
</tr>
<tr>
<td>这之后客户C用完了钱，归还后再借给A 7块钱。</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>银行家</th>
<th>客户A(9)</th>
<th>客户B(3)</th>
<th>客户C(8)</th>
</tr>
</thead>
<tbody><tr>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2</td>
<td>4</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3（满足）</td>
<td>4</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>（已归还）</td>
<td>4</td>
</tr>
<tr>
<td>0</td>
<td>2</td>
<td>（已归还）</td>
<td>8</td>
</tr>
<tr>
<td>8</td>
<td>2</td>
<td>（已归还）</td>
<td>（已归还）</td>
</tr>
<tr>
<td>1</td>
<td>9</td>
<td>（已归还）</td>
<td>（已归还）</td>
</tr>
<tr>
<td>最后客户A归还了钱，银行家收获了利息。</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>所以，每个客户必须一开始就声明他们所要借款或贷款的总额，然后银行家根据资源的情况和客户的情况先算好什么时候借给谁，什么时候谁归还。</p>
<p>这个想法应用到操作系统，操作系统就是这个银行家，它必须提前计算好每个线程何时上锁，何时解锁，这样就在程序执行之前避免了死锁。</p>
<p><strong>添加超时时间</strong><br>就是为死锁设定一个超时时间，如果两个线程产生了死锁，到达这个超时时间之后，采用kill线程的方式解开死锁。</p>
<h3 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h3><p>实现多任务的另一种方式。</p>
<p>程序是静态的，是一个exe文件或者是其他的东西，运行起来就是进程，一个进程包含多个线程。</p>
<p>一个程序一般来说可以开多个，比如QQ程序，打开之后就是多个QQ进程。</p>
<p>进程是启动的程序，所以进程比程序多拥有了资源，比如QQ进程可以使用内存资源，可以通过网卡连接网络，以及鼠标键盘等资源。所以进程是一个资源分配的单位。</p>
<h4 id="1-使用进程实现多任务"><a href="#1-使用进程实现多任务" class="headerlink" title="1.使用进程实现多任务"></a>1.使用进程实现多任务</h4><p>程序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line">def test1():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">		time.sleep(1)</span><br><span class="line"></span><br><span class="line">def test2():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">		time.sleep(1)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; multiprocessing.Process(target&#x3D;test1)</span><br><span class="line">	t2 &#x3D; multiprocessing.Process(target&#x3D;test2)</span><br><span class="line"></span><br><span class="line">	t1.start()</span><br><span class="line">	t2.start()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test02.py</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;111111&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;222222&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<p>此时如果是Windows系统可以在另外一个终端输入<code>tasklist</code>命令来查看当前系统运行的所有进程。</p>
<p>一部分如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">映像名称                       PID 会话名              会话&#39;#       内存使用</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">chrome.exe                   11504 Console                    1     51,440 K</span><br><span class="line">chrome.exe                   10496 Console                    1     21,892 K</span><br><span class="line">python.exe                    7680 Console                    1     11,908 K</span><br><span class="line">python.exe                    5356 Console                    1     12,032 K</span><br><span class="line">python.exe                    8984 Console                    1     12,036 K</span><br><span class="line">tasklist.exe                  6004 Console                    1      9,028 K</span><br></pre></td></tr></table></figure>
<p>当结束程序，再次查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">映像名称                       PID 会话名              会话&#39;#       内存使用</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">conhost.exe                  11024 Console                    1     16,896 K</span><br><span class="line">chrome.exe                   11224 Console                    1     91,268 K</span><br><span class="line">chrome.exe                   12280 Console                    1     71,120 K</span><br><span class="line">chrome.exe                    1608 Console                    1     66,956 K</span><br><span class="line">chrome.exe                   11504 Console                    1     51,436 K</span><br><span class="line">chrome.exe                   10496 Console                    1     21,896 K</span><br><span class="line">tasklist.exe                  7740 Console                    1      9,016 K</span><br></pre></td></tr></table></figure>
<p>发现python的程序已经没有了。</p>
<p>如果是linux系统可以用<code>ps -aux</code>来查看。</p>
<p>Windows系统用<code>taskkill /pid 端口 /F</code>来停止进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;taskkill &#x2F;pid 1996 &#x2F;F</span><br><span class="line">成功: 已终止 PID 为 1996 的进程。</span><br></pre></td></tr></table></figure>
<p>linux系统可以用<code>kill + 进程ID</code>来停止进程。</p>
<p>当主进程从上到下扫描代码，开始执行时，执行到t1.start()这一行，会创建一个新的子进程，这个新的子进程拥有另一份属于自己的资源，新的子进程被创建的时候，要修改的东西会拷贝一份自己的，不修改的就不拷贝了，共享代码（因为在运行过程中不会修改代码），也就是说能共享的就会共享，不能共享的就复制一份自己的（所以有一个概念是“写时拷贝”，即修改的时候拷贝）。所以多进程会占用较大的资源，所以进程数不是越多越好。</p>
<p>所以在执行刚刚的程序时，可以看到三个Python进程，一个是主进程，另外两个是子进程。</p>
<h4 id="2-进程和线程的对比"><a href="#2-进程和线程的对比" class="headerlink" title="2.进程和线程的对比"></a>2.进程和线程的对比</h4><p>进程：是资源的总称，包括代码，包括内存等。</p>
<p>线程：比较轻量级，线程之间资源共享。</p>
<ul>
<li>进程仅仅是一个资源分配的单位，是一个资源总和，而线程是操作系统调度的单位。</li>
<li>多线程是在同一份资源的前提下执行代码，而多进程是多份资源，同一份代码或多份代码，各自使用各自的资源去执行。</li>
<li>每一个进程都至少拥有一个线程（主线程），真正去执行的是线程。也就是说每创建一个进程，这个进程就会有一个主线程去使用资源执行代码。</li>
<li>进程依赖与进程，比如一个网易云音乐运行之后是一个进程，这个进程可以开启多个线程，比如下载歌曲线程和播放歌曲线程，这两个线程之间共享资源，下载后的歌曲可以由播放线程来播放，但是一旦关闭网易云，就是关闭了进程，线程也就不存在了。</li>
<li>进程之间是互相独立的，比如QQ音乐和网易云音乐之间是独立的。</li>
</ul>
<h4 id="3-使用队列完成进程间通信"><a href="#3-使用队列完成进程间通信" class="headerlink" title="3.使用队列完成进程间通信"></a>3.使用队列完成进程间通信</h4><p>如果想使用多进程来实现多任务，比如想用一个进程来下载音乐，一个进程来播放下载好的音乐，那进程之间就需要进行通信。</p>
<p>进程间通信的一种方式是队列：Queue。</p>
<p><strong>Queue如何使用：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 使用Queue要导入这个模块</span><br><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line"># 创建队列，括号中可以填一个数字，表示创建的队列中可以放多少元素，队列中的元素可以放不同数据类型的数据</span><br><span class="line">q &#x3D; multiprocessing.Queue()</span><br><span class="line">q &#x3D; multiprocessing.Queue(3)</span><br><span class="line"></span><br><span class="line"># 往队列中存放数据</span><br><span class="line">q.put()</span><br><span class="line"></span><br><span class="line"># 从队列中取数据，如果这时候队列为空，q.get()就会一直等待，等到队列中有数据了再取出来。</span><br><span class="line">q.get()</span><br><span class="line"></span><br><span class="line"># 如果不想等待可以使用get_nowait，但是如果这时候队列中没有数据，就会抛异常。</span><br><span class="line">q.get_nowait()</span><br><span class="line"></span><br><span class="line"># 判断队列是否为空，如果为空，返回True，否则返回False</span><br><span class="line">q.empty()</span><br><span class="line"></span><br><span class="line"># 判断队列是否已满，已满则返回True，否则返回False</span><br><span class="line">q.full()</span><br></pre></td></tr></table></figure>

<p><strong>进程之间通过Queue通信的实现：</strong><br>一个进程用来下载数据，这个进程把下载好的数据存放在队列中，另一个进程从这个队列取数据来进行操作。</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line">def download(q):</span><br><span class="line">	data &#x3D; [11, 22, 33, 44]</span><br><span class="line">	for tmp in data:</span><br><span class="line">		q.put(tmp)</span><br><span class="line">	print(&quot;download OK!&quot;)</span><br><span class="line"></span><br><span class="line">def use(q):</span><br><span class="line">	res &#x3D; []</span><br><span class="line">	while not q.empty():</span><br><span class="line">		res.append(q.get())</span><br><span class="line">	print(&quot;res is:&quot;)</span><br><span class="line">	print(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	q &#x3D; multiprocessing.Queue()</span><br><span class="line"></span><br><span class="line">	p1 &#x3D; multiprocessing.Process(target&#x3D;download, args&#x3D;(q,))</span><br><span class="line">	p2 &#x3D; multiprocessing.Process(target&#x3D;use, args&#x3D;(q,))</span><br><span class="line"></span><br><span class="line">	p1.start()</span><br><span class="line">	p2.start()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python test02.py</span><br><span class="line">download OK!</span><br><span class="line">res is:</span><br><span class="line">[11, 22, 33, 44]</span><br></pre></td></tr></table></figure>

<h4 id="4-进程池"><a href="#4-进程池" class="headerlink" title="4.进程池"></a>4.进程池</h4><p>进程的创建和销毁需要消耗很多资源。所以为了减少创建和消耗进程的次数，使用进程池，先创建好固定数量的进程，如果需要执行程序，让这些进程去执行，当执行结束后，把这些进程再放入进程池，这样可以反复利用创建好的进程，不用反复的创建和销毁。</p>
<p>进程池Pool的使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Pool也是在multiprocessing这个包中</span><br><span class="line">from multiprocessing import Pool</span><br><span class="line"></span><br><span class="line"># 传递参数，进程池里放多少进程，也可以不传参数</span><br><span class="line">pool &#x3D; Pool(3)</span><br><span class="line"></span><br><span class="line"># pool.apply_async(调用的目标,(传递的参数元组,)) 这里的逗号是必须的。</span><br><span class="line"># 用进程池里空闲的子进程去调用目标，如果当前没有空闲的子进程，任务也会被添加到进程池里，等待子进程空闲的时候去执行</span><br><span class="line">pool.apply_async(work,(i,))</span><br><span class="line"></span><br><span class="line"># 关闭进程池，不再接收新的请求</span><br><span class="line">pool.close()</span><br><span class="line"></span><br><span class="line"># 等待所有的子进程结束再结束程序，必须放在close语句之后，如果没有这句话，不能保证子进程都执行完毕。因为通过进程池创建的子进程，主进程不会自动等待他们执行完毕。</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def work(num):</span><br><span class="line">    print(&quot;------start-------&quot;)</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    print(num)</span><br><span class="line">    print(&quot;------end---------&quot;)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    pool &#x3D; Pool(3)</span><br><span class="line">    for i in range(10):</span><br><span class="line">        pool.apply_async(work,(i,))</span><br><span class="line"></span><br><span class="line">    print(&quot;------come to close---------&quot;)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    print(&quot;------come to an end--------&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ python test03.py</span><br><span class="line">------start-------</span><br><span class="line">2</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">5</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">6</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">0</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">4</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">7</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">1</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">3</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">8</span><br><span class="line">------end---------</span><br><span class="line">------start-------</span><br><span class="line">9</span><br><span class="line">------end---------</span><br><span class="line">------come to close---------</span><br><span class="line">------come to an end--------</span><br></pre></td></tr></table></figure>
<p>可以看到，进程的调度顺序也是不确定的。</p>
<h4 id="5-多进程实现复制文件夹下的多个文件"><a href="#5-多进程实现复制文件夹下的多个文件" class="headerlink" title="5.多进程实现复制文件夹下的多个文件"></a>5.多进程实现复制文件夹下的多个文件</h4><p>1.获取要复制的文件夹的名字</p>
<p>2.创建一个新的文件夹</p>
<p>3.获取文件夹所有要复制的文件名字</p>
<p>4.创建进程池，主进程往进程池里添加要复制的文件</p>
<p>5.子进程把文件复制到新的文件夹中去</p>
<p>当前有如下文件夹及文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;d&#x2F;test:</span><br><span class="line">$ ls</span><br><span class="line">1.py  2.py  3.py  4.py  5.py  6.py  7.py  8.py  9.py</span><br></pre></td></tr></table></figure>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line">def copy(file, old_folder, new_folder):</span><br><span class="line">	old_f &#x3D;  open(old_folder + &quot;&#x2F;&quot; + file, &quot;rb&quot;)</span><br><span class="line">	content &#x3D; old_f.read()</span><br><span class="line">	old_f.close()</span><br><span class="line"></span><br><span class="line">	new_f &#x3D; open(new_folder + &quot;&#x2F;&quot; + file, &quot;wb&quot;)</span><br><span class="line">	new_f.write(content)</span><br><span class="line">	new_folder.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	source_folder &#x3D; &#39;test&#39;</span><br><span class="line"></span><br><span class="line">	try:</span><br><span class="line">		new_folder &#x3D; source_folder + &quot;_copy&quot;</span><br><span class="line">		os.mkdir(new_folder)</span><br><span class="line">	except:</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	files &#x3D; os.listdir(source_folder)</span><br><span class="line"></span><br><span class="line">	pool &#x3D; multiprocessing.Pool(5)</span><br><span class="line"></span><br><span class="line">	for f in files:</span><br><span class="line">		pool.apply_async(copy, (f, source_folder, new_folder))</span><br><span class="line"></span><br><span class="line">	pool.close()</span><br><span class="line">	pool.join()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python test04.py</span><br></pre></td></tr></table></figure>
<p>查看当前目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test.py      </span><br><span class="line">test_copy&#x2F;</span><br></pre></td></tr></table></figure>
<p>已经成功复制了test，进入test_copy目录下，看看文件是否复制成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls test_copy&#x2F;</span><br><span class="line">1.py  2.py  3.py  4.py  5.py  6.py  7.py  8.py  9.py</span><br></pre></td></tr></table></figure>
<p>已经成功复制了。</p>
<p>改进：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import multiprocessing</span><br><span class="line"></span><br><span class="line">def copy(queue, file, old_folder, new_folder):</span><br><span class="line">	old_f &#x3D;  open(old_folder + &quot;&#x2F;&quot; + file, &quot;rb&quot;)</span><br><span class="line">	content &#x3D; old_f.read()</span><br><span class="line">	old_f.close()</span><br><span class="line"></span><br><span class="line">	new_f &#x3D; open(new_folder + &quot;&#x2F;&quot; + file, &quot;wb&quot;)</span><br><span class="line">	new_f.write(content)</span><br><span class="line">	new_folder.close()</span><br><span class="line">	queue.put(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	source_folder &#x3D; &#39;test&#39;</span><br><span class="line"></span><br><span class="line">	try:</span><br><span class="line">		new_folder &#x3D; source_folder + &quot;_copy&quot;</span><br><span class="line">		os.mkdir(new_folder)</span><br><span class="line">	except:</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	files &#x3D; os.listdir(source_folder)</span><br><span class="line"></span><br><span class="line">	pool &#x3D; multiprocessing.Pool(5)</span><br><span class="line">	queue &#x3D; multiprocessing.Manager().Queue()</span><br><span class="line"></span><br><span class="line">	for f in files:</span><br><span class="line">		pool.apply_async(copy, (queue, f, source_folder, new_folder))</span><br><span class="line"></span><br><span class="line">	pool.close()</span><br><span class="line">	# pool.join()</span><br><span class="line">	lenth &#x3D; len(files)</span><br><span class="line">	num &#x3D; 0</span><br><span class="line">	while True:</span><br><span class="line">		try:</span><br><span class="line">			name &#x3D; queue.get_nowait()</span><br><span class="line">		except:</span><br><span class="line">			pass</span><br><span class="line">		num +&#x3D; 1</span><br><span class="line">		print(&quot;\r拷贝进度为 %.2f %%&quot; % (num*100&#x2F;lenth), end&#x3D;&quot;&quot;)</span><br><span class="line">		if num &gt;&#x3D; lenth:</span><br><span class="line">			break</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<ul>
<li>这里使用的不是multiprocessing下的Queue，而是multiprocessing下的manager下的Queue。</li>
<li>结合了进程之间使用Queue进行通信，实现多进程复制文件。</li>
<li>用一个简单的方式打印了拷贝进度。</li>
</ul>
<p>运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test04.py</span><br><span class="line">拷贝进度为 100.00 %</span><br></pre></td></tr></table></figure>

<h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><h4 id="1-迭代器"><a href="#1-迭代器" class="headerlink" title="1.迭代器"></a>1.迭代器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for tmp in a:</span><br><span class="line">   print(tmp)</span><br></pre></td></tr></table></figure>
<p>如果a是可以在上面的代码里使用的数据类型，a就是可迭代对象。</p>
<p>元组，列表，字典，集合，字符串都是可迭代的对象。</p>
<p>如何判断一个对象是否是可迭代的？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from collections import Iterable</span><br><span class="line">isinstance(要判断的对象，Iterable)</span><br></pre></td></tr></table></figure>
<p>如果是可迭代的对象会返回一个True，否则返回False。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [5]: from collections import Iterable</span><br><span class="line"></span><br><span class="line">In [6]: a &#x3D; [11,22,33]</span><br><span class="line"></span><br><span class="line">In [7]: isinstance(a, Iterable)</span><br><span class="line">Out[7]: True</span><br></pre></td></tr></table></figure>
<p>如果想要一个类也变成一个可迭代对象，那么可以在类中添加一个<code>__iter__</code>方法。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from collections import Iterable</span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassName&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line">print(&quot;判断classmate是否是可迭代对象：&quot;, isinstance(classmate,Iterable))</span><br></pre></td></tr></table></figure>
<p>运行这个程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">test05.py:1: DeprecationWarning: Using or importing the ABCs from &#39;collections&#39; instead of from &#39;collections.abc&#39; is deprecated since Python 3.3,and in 3.9 it will stop working</span><br><span class="line">  from collections import Iterable</span><br><span class="line">判断classmate是否是可迭代对象： False</span><br></pre></td></tr></table></figure>
<p>提示了collections的用法变了，所以修改一下程序：<br><code>from collections.abc import Iterable</code><br>再次执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">判断classmate是否是可迭代对象： False</span><br></pre></td></tr></table></figure>
<p>这时候给类添加一个<code>__iter__</code>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from collections.abc import Iterable</span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassName&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line">print(&quot;判断classmate是否是可迭代对象：&quot;, isinstance(classmate,Iterable))</span><br></pre></td></tr></table></figure>
<p>运行一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">判断classmate是否是可迭代对象： True</span><br></pre></td></tr></table></figure>
<p>即使是没有具体实现，只要有这个魔法函数，这个类的实例对象也是可迭代对象。</p>
<p>这时候就满足了最基本的for循环条件，但是这时候还用不了。这是因为for循环的时候，每次要取一个值，还需要一个东西来记录取到了哪。</p>
<p>所以<code>__iter__</code>方法必须返回一个对象的引用，这个对象必须要有<code>__iter__</code>和<code>__next__</code>方法，这个对象就是一个迭代器。</p>
<p>判断一个对象是否是迭代器：</p>
<ul>
<li>这时候导入的是collections下的Iterator</li>
<li>使用<code>iter(对象)</code>方法可以自动调用对象的<code>__iter__</code>方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from collections.abc import Iterable</span><br><span class="line">from collections.abc import Iterator</span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for Classmate&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		return ClassIterator()</span><br><span class="line"></span><br><span class="line">class ClassIterator(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassIterator&quot;&quot;&quot;</span><br><span class="line">	def __iter__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	def __next__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line">print(&quot;判断classmate是否是可迭代对象：&quot;, isinstance(classmate,Iterable))</span><br><span class="line"># 因为&#96;__iter__&#96;方法返回的是ClassIterator()的引用，所以&#96;iter()&#96;方法得到的也是ClassIterator()的引用。</span><br><span class="line">classmate_iterator &#x3D; iter(classmate)</span><br><span class="line">print(&quot;判断classmate是否是迭代器：&quot;,isinstance(classmate_iterator,Iterator))</span><br></pre></td></tr></table></figure>
运行程序：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">判断classmate是否是可迭代对象： True</span><br><span class="line">判断classmate是否是迭代器： True</span><br></pre></td></tr></table></figure>
for循环每次调用的是这个对象的<code>__iter__</code>方法返回的另一个对象的引用的<code>__next__</code>方法。</li>
</ul>
<p>所以如果使用for循环这个Classmate对象，每次取到的是Classmate对象的<code>__iter__</code>函数返回的ClassIterator对象的引用的<code>__next__</code>方法返回的值。</p>
<p>也就是如果把<code>__next__</code>的<code>pass</code>改为<code>return 11</code>的话，for循环每次返回的都应该是11。</p>
<p>修改代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from collections.abc import Iterable</span><br><span class="line">from collections.abc import Iterator</span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for Classmate&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		return ClassIterator()</span><br><span class="line"></span><br><span class="line">class ClassIterator(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassIterator&quot;&quot;&quot;</span><br><span class="line">	def __iter__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	def __next__(self):</span><br><span class="line">		return 11</span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line"># print(&quot;判断classmate是否是可迭代对象：&quot;, isinstance(classmate,Iterable))</span><br><span class="line"># classmate_iterator &#x3D; iter(classmate)</span><br><span class="line"># print(&quot;判断classmate是否是迭代器：&quot;,isinstance(classmate_iterator,Iterator))</span><br><span class="line"></span><br><span class="line">for name in classmate:</span><br><span class="line">	print(name)</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">11</span><br><span class="line">11</span><br><span class="line">11</span><br><span class="line">11</span><br><span class="line">11</span><br></pre></td></tr></table></figure>
<p>打印11无限循环。</p>
<p>但是实际上，希望ClassIterator实现的功能是把Classmate的name列表逐个取到，那么就可以在Classmate的<code>__iter__</code>函数返回ClassIterator引用的时候，把Classmate传过去。这样ClassIterator就可以取到name这一个列表。</p>
<p>修改代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from collections.abc import Iterable</span><br><span class="line">from collections.abc import Iterator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for Classmate&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		return ClassIterator(self)</span><br><span class="line"></span><br><span class="line">class ClassIterator(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassIterator&quot;&quot;&quot;</span><br><span class="line">	def __init__(self, obj):</span><br><span class="line">		self.obj &#x3D; obj</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	def __next__(self):</span><br><span class="line">		return self.obj.name[0]</span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line"># print(&quot;判断classmate是否是可迭代对象：&quot;, isinstance(classmate,Iterable))</span><br><span class="line"># classmate_iterator &#x3D; iter(classmate)</span><br><span class="line"># print(&quot;判断classmate是否是迭代器：&quot;,isinstance(classmate_iterator,Iterator))</span><br><span class="line"></span><br><span class="line">for name in classmate:</span><br><span class="line">	print(name)</span><br><span class="line">	time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>这时候ClassIterator类可以取到Classmate的name列表。但是每次取到的都是name[0]，想要继续往下取，就需要一个下标，每次取完一次，下标就加一。</p>
<p>修改代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from collections.abc import Iterable</span><br><span class="line">from collections.abc import Iterator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for Classmate&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		return ClassIterator(self)</span><br><span class="line"></span><br><span class="line">class ClassIterator(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassIterator&quot;&quot;&quot;</span><br><span class="line">	def __init__(self, obj):</span><br><span class="line">		self.obj &#x3D; obj</span><br><span class="line">		self.cur_index &#x3D; 0</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	def __next__(self):</span><br><span class="line">                # 防止下标越界</span><br><span class="line">		if self.cur_index &lt; len(self.obj.name):</span><br><span class="line">			res &#x3D; self.obj.name[self.cur_index]</span><br><span class="line">			self.cur_index +&#x3D; 1</span><br><span class="line">			return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line"># print(&quot;判断classmate是否是可迭代对象：&quot;, isinstance(classmate,Iterable))</span><br><span class="line"># classmate_iterator &#x3D; iter(classmate)</span><br><span class="line"># print(&quot;判断classmate是否是迭代器：&quot;,isinstance(classmate_iterator,Iterator))</span><br><span class="line"></span><br><span class="line">for name in classmate:</span><br><span class="line">	print(name)</span><br><span class="line">	time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>运行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">同学一</span><br><span class="line">同学二</span><br><span class="line">同学三</span><br><span class="line">None</span><br><span class="line">None</span><br><span class="line">None</span><br><span class="line">None</span><br><span class="line">None</span><br></pre></td></tr></table></figure>
<p>这时候会发生一种情况就是，当for已经取完name列表中的所有元素之后，并不会停止，会继续取name的值，但是因为当前的下标已经等于或超过name列表的长度，所以<code>__next__</code>方法没有返回任何值，所以for循环继续，但是每次取到的值都是None。</p>
<p>所以如果想让for循环结束，需要抛出一个<code>StopIteration</code>异常，for就会结束循环。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from collections.abc import Iterable</span><br><span class="line">from collections.abc import Iterator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for Classmate&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		return ClassIterator(self)</span><br><span class="line"></span><br><span class="line">class ClassIterator(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for ClassIterator&quot;&quot;&quot;</span><br><span class="line">	def __init__(self, obj):</span><br><span class="line">		self.obj &#x3D; obj</span><br><span class="line">		self.cur_index &#x3D; 0</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		pass</span><br><span class="line"></span><br><span class="line">	def __next__(self):</span><br><span class="line">		if self.cur_index &lt; len(self.obj.name):</span><br><span class="line">			res &#x3D; self.obj.name[self.cur_index]</span><br><span class="line">			self.cur_index +&#x3D; 1</span><br><span class="line">			return res</span><br><span class="line">		else:</span><br><span class="line">			raise StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line">for name in classmate:</span><br><span class="line">	print(name)</span><br><span class="line">	time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>运行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">同学一</span><br><span class="line">同学二</span><br><span class="line">同学三</span><br></pre></td></tr></table></figure>

<p>那么Classmate的<code>__iter__</code>可不可以返回自身，这样就不用返回别的类的引用。</p>
<p>修改代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from collections.abc import Iterable</span><br><span class="line">from collections.abc import Iterator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Classmate(object):</span><br><span class="line">	&quot;&quot;&quot;docstring for Classmate&quot;&quot;&quot;</span><br><span class="line">	def __init__(self):</span><br><span class="line">		self.name &#x3D; list()</span><br><span class="line">		self.cur_index &#x3D; 0</span><br><span class="line"></span><br><span class="line">	def add(self, name):</span><br><span class="line">		self.name.append(name)</span><br><span class="line"></span><br><span class="line">	def __iter__(self):</span><br><span class="line">		return self</span><br><span class="line"></span><br><span class="line">	def __next__(self):</span><br><span class="line">		if self.cur_index &lt; len(self.name):</span><br><span class="line">			res &#x3D; self.name[self.cur_index]</span><br><span class="line">			self.cur_index +&#x3D; 1</span><br><span class="line">			return res</span><br><span class="line">		else:</span><br><span class="line">			raise StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">classmate &#x3D; Classmate()</span><br><span class="line"></span><br><span class="line">classmate.add(&quot;同学一&quot;)</span><br><span class="line">classmate.add(&quot;同学二&quot;)</span><br><span class="line">classmate.add(&quot;同学三&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for name in classmate:</span><br><span class="line">	print(name)</span><br><span class="line">	time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>执行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test05.py</span><br><span class="line">同学一</span><br><span class="line">同学二</span><br><span class="line">同学三</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li>如果一个对象是迭代器，那么它一定可以迭代。因为它一定包含<code>__iter__</code>和<code>__next__</code>。</li>
<li>一个对象可迭代，它不一定是迭代器。<h4 id="2-生成器"><a href="#2-生成器" class="headerlink" title="2.生成器"></a>2.生成器</h4>生成器是一种特殊的迭代器。<br>#####（1）创建生成器的方式</li>
</ul>
<p><strong>方法1：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nums &#x3D; [x*2 for i in range(10)]</span><br></pre></td></tr></table></figure>
<p>nums会得到一个列表，如果把中括号变为小括号，nums得到的就是一个生成器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">In [11]: nums &#x3D; [ x*2 for x in range(10)]</span><br><span class="line"></span><br><span class="line">In [12]: nums</span><br><span class="line">Out[12]: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]</span><br><span class="line"></span><br><span class="line">In [13]: nums2 &#x3D; (x*2 for x in range(10))</span><br><span class="line"></span><br><span class="line">In [14]: nums2</span><br><span class="line">Out[14]: &lt;generator object &lt;genexpr&gt; at 0x0000015761EE6DC8&gt;</span><br><span class="line"></span><br><span class="line">In [15]: for i in nums:</span><br><span class="line">    ...:     print(i)</span><br><span class="line">    ...:</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line">12</span><br><span class="line">14</span><br><span class="line">16</span><br><span class="line">18</span><br><span class="line"></span><br><span class="line">In [16]: for i in nums2:</span><br><span class="line">    ...:     print(i)</span><br><span class="line">    ...:</span><br><span class="line">0</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br><span class="line">10</span><br><span class="line">12</span><br><span class="line">14</span><br><span class="line">16</span><br><span class="line">18</span><br></pre></td></tr></table></figure>
<p>生成器和列表都可以用for遍历。<br><strong>方法2：</strong></p>
<p>把函数变为生成器。</p>
<p>只要函数里有<code>yield</code>，那么这个函数就会变成生成器。</p>
<p>如果想得到斐波那契数列的前多少位，可以这样来实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		print(a)</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">worker(10)</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br></pre></td></tr></table></figure>
<p>如果把print改为yield，那么这个函数就变成了一个生成器。调用这个生成器的方式和原来调用函数的方式不同。如果这时候还使用<code>worker(10)</code>的方式，不是在调用函数，而是在创建一个生成器对象。在使用for循环遍历这个生成器对象，就可以每次取到一个值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		# print(a)</span><br><span class="line">		yield a</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">for i in obj:</span><br><span class="line">	print(i)</span><br></pre></td></tr></table></figure>
<p>执行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br></pre></td></tr></table></figure>
<p>for从obj里逐个取值的时候，第一次从worker的开始执行，执行到yield把a的值返回，然后第二次for再取值的时候，不是从worker的头开始执行，而是从上一次yield停止的位置继续往下执行。</p>
<p>如果每次只想取一个值打印出来，可以使用next：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		# print(a)</span><br><span class="line">		yield a</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>next会取到当前yield后面的值，然后下次调用再取下一个值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>也就是想让生成器执行，要使用next让他执行，而不是调用生成器。</p>
<p>如果创建的是多个生成器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		# print(a)</span><br><span class="line">		yield a</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">obj2 &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj2)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">res &#x3D; next(obj2)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>运行一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>两个生成器对象之间互相没有影响。</p>
<p><strong>生成器的结束</strong><br>还是使用异常让生成器结束遍历。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		# print(a)</span><br><span class="line">		yield a</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(2)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">	try:</span><br><span class="line">		print(next(obj))</span><br><span class="line">	except Exception as res:</span><br><span class="line">		break</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>如果这个生成器有返回值，可以用下面的方式得到它的返回值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		# print(a)</span><br><span class="line">		yield a</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line">	return &quot;OK!&quot;</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">	try:</span><br><span class="line">		print(next(obj))</span><br><span class="line">	except Exception as res:</span><br><span class="line">		print(res.value)</span><br><span class="line">		break</span><br></pre></td></tr></table></figure>
<p>运行程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br><span class="line">OK!</span><br></pre></td></tr></table></figure>
<p><strong>生成器的启动还可以用send</strong><br>用法：<code>生成器对象.sen(参数)</code></p>
<p>程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		res &#x3D; yield a</span><br><span class="line">		print(res)</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">print(next(obj))</span><br><span class="line">print(obj.send(&quot;haha&quot;))</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br><span class="line">haha</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>执行过程：<br>当用next启动生成器的时候，从worker的头开始执行，执行到<code>yield a</code>把a的值返回，然后打印出来。当send启动生成器的时候，系统从上一次yield的位置接着往下执行，执行到的第一条语句是把yield a 的值赋给res，yield a的值就是send中传递的参数，这时候res = “haha”，然后程序继续往下执行，打印出这个res。</p>
<p>send与next相比，优点就是可以传递参数。</p>
<p>send如果传递了参数不能一开始就调用，调用，会出错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		res &#x3D; yield a</span><br><span class="line">		print(res)</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">print(obj.send(&quot;haha&quot;))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;test06.py&quot;, line 12, in &lt;module&gt;</span><br><span class="line">    print(obj.send(&quot;haha&quot;))</span><br><span class="line">TypeError: can&#39;t send non-None value to a just-started generator</span><br></pre></td></tr></table></figure>
<p>如果没有参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def worker(tmp):</span><br><span class="line">	a, b &#x3D; 0, 1</span><br><span class="line">	cur &#x3D; 0</span><br><span class="line">	while cur &lt; tmp:</span><br><span class="line">		res &#x3D; yield a</span><br><span class="line">		print(res)</span><br><span class="line">		a , b &#x3D; b, a+b</span><br><span class="line">		cur +&#x3D; 1</span><br><span class="line"></span><br><span class="line">obj &#x3D; worker(10)</span><br><span class="line"></span><br><span class="line">print(obj.send(None))</span><br></pre></td></tr></table></figure>
<p>运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test06.py</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<p>#####（2）使用yield实现多任务（协程实现多任务）<br>只要在函数里面写上<code>yield</code>，函数就变成了一个生成器，再创建生成器对象，调用next即可。</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">def task01():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;task01&quot;)</span><br><span class="line">		time.sleep(1)</span><br><span class="line">		yield</span><br><span class="line"></span><br><span class="line">def task02():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;task02&quot;)</span><br><span class="line">		time.sleep(1)</span><br><span class="line">		yield</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	t1 &#x3D; task01()</span><br><span class="line">	t2 &#x3D; task02()</span><br><span class="line">	while True:</span><br><span class="line">		next(t1)</span><br><span class="line">		next(t2)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test07.py</span><br><span class="line">task01</span><br><span class="line">task02</span><br><span class="line">task01</span><br><span class="line">task02</span><br><span class="line">task01</span><br><span class="line">task02</span><br><span class="line">task01</span><br><span class="line">task02</span><br><span class="line">task01</span><br><span class="line">task02</span><br><span class="line">task01</span><br><span class="line">task02</span><br></pre></td></tr></table></figure>
<p>这是一个协程的并发（假的“一起”执行）。<br>#####（3）使用greenlet、gevent实现多任务（协程实现多任务）<br>使用greenlet可以替换yield。</p>
<p>要使用greenlet需要导入：<br><code>from greenlet import greenlet</code><br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from greenlet import greenlet</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def test1():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;test1&quot;)</span><br><span class="line">		# 切换到gr2去执行</span><br><span class="line">		gr2.switch()</span><br><span class="line">		time.sleep(0.5)</span><br><span class="line"></span><br><span class="line">def test2():</span><br><span class="line">	while True:</span><br><span class="line">		print(&quot;test2&quot;)</span><br><span class="line">		# 切换到gr1去执行</span><br><span class="line">		gr1.switch()</span><br><span class="line">		time.sleep(0.5)</span><br><span class="line"></span><br><span class="line"># 返回值是一个greenlet对象</span><br><span class="line">gr1 &#x3D; greenlet(test1)</span><br><span class="line">gr2 &#x3D; greenlet(test2)</span><br><span class="line"></span><br><span class="line">gr1.switch()</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test07.py</span><br><span class="line">test1</span><br><span class="line">test2</span><br><span class="line">test1</span><br><span class="line">test2</span><br><span class="line">test1</span><br><span class="line">test2</span><br></pre></td></tr></table></figure>
<p>greenlet的切换是在单线程内切换，而如果想要切换到其他的协程，真正实现多任务，就需要用到gevent。</p>
<p>gevent也需要导入：<br><code>import gevent</code><br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import gevent</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def test(n):</span><br><span class="line">	for i in range(n):</span><br><span class="line">		print(gevent.getcurrent(), i)</span><br><span class="line"></span><br><span class="line"># 指定去哪执行</span><br><span class="line">g1 &#x3D; gevent.spawn(test, 5)</span><br><span class="line">g2 &#x3D; gevent.spawn(test, 5)</span><br><span class="line">g3 &#x3D; gevent.spawn(test, 5)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br><span class="line">g3.join()</span><br></pre></td></tr></table></figure>
<p>运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test07.py</span><br><span class="line">&lt;Greenlet at 0x158e64a3e18: test(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x158e64a3e18: test(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x158e64a3e18: test(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x158e64a3e18: test(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x158e64a3e18: test(5)&gt; 4</span><br><span class="line">&lt;Greenlet at 0x158e6514048: test(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x158e6514048: test(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x158e6514048: test(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x158e6514048: test(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x158e6514048: test(5)&gt; 4</span><br><span class="line">&lt;Greenlet at 0x158e6514378: test(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x158e6514378: test(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x158e6514378: test(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x158e6514378: test(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x158e6514378: test(5)&gt; 4</span><br></pre></td></tr></table></figure>

<p>在greenlet中，遇到延时，程序会等待这个延时结束，再去切换另一个任务，而gevent遇到延时就会自动切换。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import gevent</span><br><span class="line"></span><br><span class="line">def test01(n):</span><br><span class="line">	for i in range(n):</span><br><span class="line">		print(gevent.getcurrent(), i)</span><br><span class="line">		gevent.sleep(0.5)</span><br><span class="line"></span><br><span class="line">def test02(n):</span><br><span class="line">	for i in range(n):</span><br><span class="line">		print(gevent.getcurrent(), i)</span><br><span class="line">		gevent.sleep(0.5)</span><br><span class="line"></span><br><span class="line">def test03(n):</span><br><span class="line">	for i in range(n):</span><br><span class="line">		print(gevent.getcurrent(), i)</span><br><span class="line">		gevent.sleep(0.5)</span><br><span class="line"></span><br><span class="line">g1 &#x3D; gevent.spawn(test01, 5)</span><br><span class="line">g2 &#x3D; gevent.spawn(test02, 5)</span><br><span class="line">g3 &#x3D; gevent.spawn(test03, 5)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br><span class="line">g3.join()</span><br></pre></td></tr></table></figure>
<p>运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test07.py</span><br><span class="line">&lt;Greenlet at 0x255d7d63e18: test01(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x255d7dd4048: test02(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x255d7dd4378: test03(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x255d7d63e18: test01(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x255d7dd4048: test02(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x255d7dd4378: test03(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x255d7d63e18: test01(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x255d7dd4048: test02(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x255d7dd4378: test03(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x255d7d63e18: test01(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x255d7dd4048: test02(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x255d7dd4378: test03(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x255d7d63e18: test01(5)&gt; 4</span><br><span class="line">&lt;Greenlet at 0x255d7dd4048: test02(5)&gt; 4</span><br><span class="line">&lt;Greenlet at 0x255d7dd4378: test03(5)&gt; 4</span><br></pre></td></tr></table></figure>
<p>如果是三个协程执行的是同一份代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import gevent</span><br><span class="line"></span><br><span class="line">def test01(n):</span><br><span class="line">	for i in range(n):</span><br><span class="line">		print(gevent.getcurrent(), i)</span><br><span class="line">		gevent.sleep(0.5)</span><br><span class="line"></span><br><span class="line">g1 &#x3D; gevent.spawn(test01, 5)</span><br><span class="line">g2 &#x3D; gevent.spawn(test01, 5)</span><br><span class="line">g3 &#x3D; gevent.spawn(test01, 5)</span><br><span class="line"></span><br><span class="line">g1.join()</span><br><span class="line">g2.join()</span><br><span class="line">g3.join()</span><br></pre></td></tr></table></figure>
<p>运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D:\&gt;python test07.py</span><br><span class="line">&lt;Greenlet at 0x19a8ef33e18: test01(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x19a8efa4048: test01(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x19a8efa4378: test01(5)&gt; 0</span><br><span class="line">&lt;Greenlet at 0x19a8ef33e18: test01(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x19a8efa4048: test01(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x19a8efa4378: test01(5)&gt; 1</span><br><span class="line">&lt;Greenlet at 0x19a8ef33e18: test01(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x19a8efa4048: test01(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x19a8efa4378: test01(5)&gt; 2</span><br><span class="line">&lt;Greenlet at 0x19a8ef33e18: test01(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x19a8efa4048: test01(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x19a8efa4378: test01(5)&gt; 3</span><br><span class="line">&lt;Greenlet at 0x19a8ef33e18: test01(5)&gt; 4</span><br><span class="line">&lt;Greenlet at 0x19a8efa4048: test01(5)&gt; 4</span><br><span class="line">&lt;Greenlet at 0x19a8efa4378: test01(5)&gt; 4</span><br></pre></td></tr></table></figure>
<p>先打印了每个协程的0，然后打印了1、2、3、4。</p>
<p>所以gevent在有延迟的时候，自动切换了。</p>
<p>协程依赖与线程，线程依赖于线程。</p>
<h3 id="进程、线程、协程对比"><a href="#进程、线程、协程对比" class="headerlink" title="进程、线程、协程对比"></a>进程、线程、协程对比</h3><ul>
<li>进程是资源分配的基本单位，多进程耗费资源最多。</li>
<li>多线程的程序，同一时间只有一个线程在运行。</li>
<li>在不考虑GIL的前提下，优先考虑线程，再考虑协程，再考虑进程。</li>
<li>协程利用进程在等待的时间去做别的事情，协程切换资源消耗小，效率高。</li>
<li>进程最稳定。</li>
</ul>

          
            <div class='article_footer'>
              
                
  
    
    



  

  
    
    



  

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class='content article-entry'>
    
      
        <div class='fancybox'><img src='https://i.loli.net/2020/08/11/ZBJmb41yGPoVCR7.png'
        
          height='64px'
        ></div>
      
    
  </div>
</section>

  


              
            </div>
          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-08-13T21:40:10+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Aug 13, 2020</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>Python</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2020/08/12/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAPython%E5%A4%9A%E4%BB%BB%E5%8A%A1%EF%BC%88%E7%BA%BF%E7%A8%8B%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B%EF%BC%89/&title=深入浅出Python多任务（线程，进程，协程） - Arianna_blog&summary=导入看一下下面的程序："
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/08/12/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAPython%E5%A4%9A%E4%BB%BB%E5%8A%A1%EF%BC%88%E7%BA%BF%E7%A8%8B%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B%EF%BC%89/&title=深入浅出Python多任务（线程，进程，协程） - Arianna_blog&summary=导入看一下下面的程序："
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2020/08/12/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAPython%E5%A4%9A%E4%BB%BB%E5%8A%A1%EF%BC%88%E7%BA%BF%E7%A8%8B%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%8D%8F%E7%A8%8B%EF%BC%89/&title=深入浅出Python多任务（线程，进程，协程） - Arianna_blog&summary=导入看一下下面的程序："
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
      
        
        <div class='hoverbox'>
          <a><img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/wechat.png"></a>
          <div class='target'>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdgAAAHYCAAAAADLsqZFAAAH1klEQVR42u3awZJbKQwF0P7/n87sk3IZXUk9VXDYvbT9DBxlwRU/f4wrx48tAGuANcAaYA2wYG3B5bA/4fjnhV/+/u3zf3+v+vfjhR+uq7ruT8/p+1IPsGDBggULFixYsGDBgn0Ftrox6edTwC7UaSFW55MW/GmhlPcXLFiwYMGCBQsWLFiwYB+DnVrY9nO3gKYKcOp7Yx5gwYIFCxYsWLBgwYIFCzYCSA/s6YF+q4E93ZivBhRgwYIFCxYsWLBgwYIFC3YX9rca2tX3nn6+2viuFiBYsGDBggULFixYsGDBgp2FTS+ApzBTQcPUBfNu8JAGN+sXxsGCBQsWLFiwYMGCBQv2Mthug9nz7HPsARYsWLCewXoGCxYsWLCXw3ZHtYG8HSx0A4BqQLIdQJQ9wIIFCxYsWLBgwYIFC/Zy2PSAnG5MtyG9VQBpwaUXBdb2HyxYsGDBggULFixYsGAfgT39gekDexqEpMFANVBJ3zf1H6B80QEsWLBgwYIFCxYsWLBgL4edOnh3D/qnB/d0XlMXAY43eOh3yoUAFixYsGDBggULFixYsJfDdhu7YwfrZkF0g4fuOreAy4ERWLBgwYIFCxYsWLBgwT4Ku32ArxZEt6FdBanOp7qutLDAggULFixYsGDBggUL9nXYrYN4Ghikjf0qSDfQqAYlp/NMCxwsWLBgwYIFCxYsWLBgX4MdOyAXIdIAoBqsbM1/Gmqs0Q4WLFiwYMGCBQsWLFiwl8KmjfGtxnF3A6rrShv6U/Pu/h5YsGDBggULFixYsGDBvgrb3fDqQrYa0tVGfxqAVOdfLcj4wgNYsGDBggULFixYsGDBPgK7FVB0QdLfP96I5jrTYGRtvWDBggULFixYsGDBggV7OexWw3n6YF6FS8HSIGMr+CjvI1iwYMGCBQsWLFiwYMFeDlttmHcn2m2oT8FXA4rT/UovHqTzBwsWLFiwYMGCBQsWLNjXYKtBQxdqauHVoCQNLqYKtluAx98DCxYsWLBgwYIFCxYs2MthT1/Y/eHuwb4LVgWZCmy6/yHKBQIWLFiwYMGCBQsWLFiwj8FON9a7DfDtDU+DiRRmu0EPFixYsGDBggULFixYsLfDdhviadAxVVBTFwLSeXahuu8FCxYsWLBgwYIFCxYs2Ndgpw7YU431bgN6qqC6Df9usHEa4IAFCxYsWLBgwYIFCxbsa7DVL1aDgLSB3d3oLdjpCwhpAPJx/8GCBQsWLFiwYMGCBQv2cthqEDF9EK8ezNOgoBuIdC8cbAc3YMGCBQsWLFiwYMGCBfsabHVjxxrDQ/DpxlcDkm6A0/07WLBgwYIFCxYsWLBgwYKtgZw+p8FHt7Gezq8bUEw18tvzBQsWLFiwYMGCBQsWLNjLYVOgrYN7t5DSQCUNEFKAbkDx8ffAggULFixYsGDBggUL9lHY00Chu5D0PacbfDrvtLCmGvbVeX5ttIMFCxYsWLBgwYIFCxbsI7BpAzo9wG8XUndjtwpyreEPFixYsGDBggULFixYsI/ATh34v014unCmDvzlhnYzyEgvLIAFCxYsWLBgwYIFCxbs67BTB/Z0QtMbd/o7aQCxBdRt4IMFCxYsWLBgwYIFCxYs2F4A8VuBxFQjPF13Ct69mPBxfWDBggULFixYsGDBggV7OWy30TzVuN6C7AYq1QsI0xcWyvMCCxYsWLBgwYIFCxYsWLDRv6eN+e7708Z2NzhJG+5TgQZYsGDBggULFixYsGDBvgLb3YjTjeoewNNCm25kV4OHKcjjiwxgwYIFCxYsWLBgwYIFezlsdeHpRlYP7unGbzW8p4KXNIg4LjSwYMGCBQsWLFiwYMGCvRx2GyrdoKnGenejpi8ATBXyx8+BBQsWLFiwYMGCBQsW7OWw3YN79wBeBasGD1PvTYOb8UY6WLBgwYIFCxYsWLBgwYJdPbBPvb8abKQH/LShnxZ+tzD/eQYLFixYsGDBggULFizYy2GrG5UGDtMLTC8KpAHCFEA1ICkHHWDBggULFixYsGDBggX7CGy6EacT3jqgp+9LC/X/KrA4oAALFixYsGDBggULFizYy2C7DeZqY3yqMd3d4GqhTRVSWkDH8wALFixYsGDBggULFizYy2GnNjANINJG/3RBdEda2Ol8Pq4fLFiwYMGCBQsWLFiwYB+DTQ/KKXzaUO82+qeClGrQkO7ncbACFixYsGDBggULFixYsI/Adhvl04XSbZB331cNSqZguxcAwIIFCxYsWLBgwYIFC/Z22G5DOW00p4WVNuK7gUC3wNJ9KxcQWLBgwYIFCxYsWLBgwYI9gk4b2tUFb214us70osDWfMGCBQsWLFiwYMGCBQv2dtifcFQX3m3Ap4FIF+QUqBp4pM/HAQVYsGDBggULFixYsGDBXg67HUh0G8xbAcVUYNBt5HeDEbBgwYIFCxYsWLBgwYJ9FXbqwP8teKh+rxpkdIOWrUBmKxACCxYsWLBgwYIFCxYsWLC7sGkQ8ltBRzfA6V4sqBYaWLBgwYIFCxYsWLBgwYLNYLtBRBdwO0ipBhZpUBPPHyxYsGDBggULFixYsGAfg60GB9MN8Oq8poOPqQJMA4juOsGCBQsWLFiwYMGCBQv2FditRvXpgX0asBogTM3vz/L4WihgwYIFCxYsWLBgwYIFezmscdcAC9YAa4A1wBpgDbCXjv8ALHQNNQDWYtMAAAAASUVORK5CYII=">
          </div>
        </div>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2020/08/13/Python%E7%9A%84args%E5%92%8Ckwargs/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>Python的*args和**kwargs</p>
                <p class='content'>当定义一个函数，这个函数可能会有不定长参数的时候，就会在函数的接收参数的括号的最后加上*args, **kwargs。

*agrs用来接收非关键字参数，以元组的形式保存，这个形参的名字叫arg...</p>
              </a>
            
            
              <a class='next' href='/2020/08/11/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAPython%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/'>
                <p class='title'>深入浅出Python深拷贝浅拷贝<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>所谓拷贝，就是复制。
深拷贝，就是复制的比较多，浅拷贝，就是复制的比较少。

在Python中，copy.copy可以完成浅拷贝，copy.deepcopy可以完成深拷贝。
举例 图解1.赋值如...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box reveal comments blur">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
          </div>
        </section>
      
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '深入浅出Python多任务（线程，进程，协程）',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow floatable blur desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入"><span class="toc-text">导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程"><span class="toc-text">线程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-threading模块"><span class="toc-text">1.threading模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-查看线程的数量"><span class="toc-text">2.查看线程的数量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-子线程是什么时候被创建的，什么时候被执行的"><span class="toc-text">3.子线程是什么时候被创建的，什么时候被执行的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-target也可以是一个类"><span class="toc-text">4.target也可以是一个类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-多个线程之间共享全局变量"><span class="toc-text">5.多个线程之间共享全局变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-共享全局变量可能遇到的问题：资源竞争"><span class="toc-text">6.共享全局变量可能遇到的问题：资源竞争</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-解决资源竞争问题"><span class="toc-text">7.解决资源竞争问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-互斥锁带来的死锁问题"><span class="toc-text">8.互斥锁带来的死锁问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进程"><span class="toc-text">进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-使用进程实现多任务"><span class="toc-text">1.使用进程实现多任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-进程和线程的对比"><span class="toc-text">2.进程和线程的对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-使用队列完成进程间通信"><span class="toc-text">3.使用队列完成进程间通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-进程池"><span class="toc-text">4.进程池</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-多进程实现复制文件夹下的多个文件"><span class="toc-text">5.多进程实现复制文件夹下的多个文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#协程"><span class="toc-text">协程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-迭代器"><span class="toc-text">1.迭代器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-生成器"><span class="toc-text">2.生成器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进程、线程、协程对比"><span class="toc-text">进程、线程、协程对比</span></a></li></ol>
    </div>
  </section>


  


</aside>


  
    <div class="container archive-calendar">
    <div class="card">
        <div id="post-calendar" class="card-content"></div>
    </div>
</div>

<script type="text/javascript" src="/js/echarts.min.js"></script>
<script type="text/javascript">
    let myChart = echarts.init(document.getElementById('post-calendar'));

    

    let option = {
        title: {
            top: 0,
            text: 'Post Calendar',
            left: 'center',
            textStyle: {
                color: '#3C4858'
            }
        },
        tooltip: {
            padding: 10,
            backgroundColor: '#555',
            borderColor: '#777',
            borderWidth: 1,
            formatter: function (obj) {
                var value = obj.value;
                return '<div style="font-size: 14px;">' + value[0] + '：' + value[1] + '</div>';
            }
        },
        visualMap: {
            show: true,
            showLabel: true,
            categories: [0, 1, 2, 3, 4],
            calculable: true,
            inRange: {
                symbol: 'rect',
                color: ['#ebedf0', '#c6e48b', '#7bc96f', '#239a3b', '#196127']
            },
            itemWidth: 12,
            itemHeight: 12,
            orient: 'horizontal',
            left: 'center',
            bottom: 0
        },
        calendar: [{
            left: 'center',
            range: ["2019-08-16", "2020-08-16"],
            cellSize: [13, 13],
            splitLine: {
                show: false
            },
            itemStyle: {
                color: '#196127',
                borderColor: '#fff',
                borderWidth: 2
            },
            yearLabel: {
                show: false
            },
            monthLabel: {
                nameMap: 'en',
                fontSize: 11
            },
            dayLabel: {
                formatter: '{start}  1st',
                nameMap: 'en',
                fontSize: 11
            }
        }],
        series: [{
            type: 'heatmap',
            coordinateSystem: 'calendar',
            calendarIndex: 0,
            data: [["2019-08-16", 0], ["2019-08-17", 0], ["2019-08-18", 0], ["2019-08-19", 0], ["2019-08-20", 0], ["2019-08-21", 0], ["2019-08-22", 0], ["2019-08-23", 0], ["2019-08-24", 0], ["2019-08-25", 0], ["2019-08-26", 0], ["2019-08-27", 0], ["2019-08-28", 0], ["2019-08-29", 0], ["2019-08-30", 0], ["2019-08-31", 0], ["2019-09-01", 0], ["2019-09-02", 0], ["2019-09-03", 0], ["2019-09-04", 0], ["2019-09-05", 0], ["2019-09-06", 0], ["2019-09-07", 0], ["2019-09-08", 0], ["2019-09-09", 0], ["2019-09-10", 0], ["2019-09-11", 0], ["2019-09-12", 0], ["2019-09-13", 0], ["2019-09-14", 0], ["2019-09-15", 0], ["2019-09-16", 0], ["2019-09-17", 0], ["2019-09-18", 0], ["2019-09-19", 0], ["2019-09-20", 0], ["2019-09-21", 0], ["2019-09-22", 0], ["2019-09-23", 0], ["2019-09-24", 0], ["2019-09-25", 0], ["2019-09-26", 0], ["2019-09-27", 0], ["2019-09-28", 0], ["2019-09-29", 0], ["2019-09-30", 0], ["2019-10-01", 0], ["2019-10-02", 0], ["2019-10-03", 0], ["2019-10-04", 0], ["2019-10-05", 0], ["2019-10-06", 0], ["2019-10-07", 0], ["2019-10-08", 0], ["2019-10-09", 0], ["2019-10-10", 0], ["2019-10-11", 0], ["2019-10-12", 0], ["2019-10-13", 0], ["2019-10-14", 0], ["2019-10-15", 0], ["2019-10-16", 0], ["2019-10-17", 0], ["2019-10-18", 0], ["2019-10-19", 0], ["2019-10-20", 0], ["2019-10-21", 0], ["2019-10-22", 0], ["2019-10-23", 0], ["2019-10-24", 0], ["2019-10-25", 0], ["2019-10-26", 0], ["2019-10-27", 0], ["2019-10-28", 0], ["2019-10-29", 0], ["2019-10-30", 0], ["2019-10-31", 0], ["2019-11-01", 0], ["2019-11-02", 0], ["2019-11-03", 0], ["2019-11-04", 0], ["2019-11-05", 0], ["2019-11-06", 0], ["2019-11-07", 0], ["2019-11-08", 0], ["2019-11-09", 0], ["2019-11-10", 0], ["2019-11-11", 0], ["2019-11-12", 0], ["2019-11-13", 0], ["2019-11-14", 0], ["2019-11-15", 0], ["2019-11-16", 0], ["2019-11-17", 0], ["2019-11-18", 0], ["2019-11-19", 0], ["2019-11-20", 0], ["2019-11-21", 0], ["2019-11-22", 0], ["2019-11-23", 0], ["2019-11-24", 0], ["2019-11-25", 0], ["2019-11-26", 0], ["2019-11-27", 0], ["2019-11-28", 0], ["2019-11-29", 0], ["2019-11-30", 0], ["2019-12-01", 0], ["2019-12-02", 0], ["2019-12-03", 0], ["2019-12-04", 0], ["2019-12-05", 0], ["2019-12-06", 0], ["2019-12-07", 0], ["2019-12-08", 0], ["2019-12-09", 0], ["2019-12-10", 0], ["2019-12-11", 0], ["2019-12-12", 0], ["2019-12-13", 0], ["2019-12-14", 0], ["2019-12-15", 0], ["2019-12-16", 0], ["2019-12-17", 0], ["2019-12-18", 0], ["2019-12-19", 0], ["2019-12-20", 0], ["2019-12-21", 0], ["2019-12-22", 0], ["2019-12-23", 0], ["2019-12-24", 0], ["2019-12-25", 0], ["2019-12-26", 0], ["2019-12-27", 0], ["2019-12-28", 0], ["2019-12-29", 0], ["2019-12-30", 0], ["2019-12-31", 0], ["2020-01-01", 0], ["2020-01-02", 0], ["2020-01-03", 0], ["2020-01-04", 0], ["2020-01-05", 0], ["2020-01-06", 0], ["2020-01-07", 0], ["2020-01-08", 0], ["2020-01-09", 0], ["2020-01-10", 0], ["2020-01-11", 0], ["2020-01-12", 0], ["2020-01-13", 0], ["2020-01-14", 0], ["2020-01-15", 0], ["2020-01-16", 0], ["2020-01-17", 0], ["2020-01-18", 0], ["2020-01-19", 0], ["2020-01-20", 0], ["2020-01-21", 0], ["2020-01-22", 0], ["2020-01-23", 0], ["2020-01-24", 0], ["2020-01-25", 0], ["2020-01-26", 0], ["2020-01-27", 0], ["2020-01-28", 0], ["2020-01-29", 0], ["2020-01-30", 0], ["2020-01-31", 0], ["2020-02-01", 0], ["2020-02-02", 0], ["2020-02-03", 0], ["2020-02-04", 0], ["2020-02-05", 0], ["2020-02-06", 0], ["2020-02-07", 0], ["2020-02-08", 0], ["2020-02-09", 0], ["2020-02-10", 0], ["2020-02-11", 0], ["2020-02-12", 0], ["2020-02-13", 0], ["2020-02-14", 0], ["2020-02-15", 0], ["2020-02-16", 0], ["2020-02-17", 0], ["2020-02-18", 0], ["2020-02-19", 0], ["2020-02-20", 0], ["2020-02-21", 0], ["2020-02-22", 0], ["2020-02-23", 0], ["2020-02-24", 0], ["2020-02-25", 0], ["2020-02-26", 0], ["2020-02-27", 0], ["2020-02-28", 0], ["2020-02-29", 0], ["2020-03-01", 0], ["2020-03-02", 0], ["2020-03-03", 0], ["2020-03-04", 0], ["2020-03-05", 0], ["2020-03-06", 0], ["2020-03-07", 0], ["2020-03-08", 0], ["2020-03-09", 0], ["2020-03-10", 0], ["2020-03-11", 1], ["2020-03-12", 0], ["2020-03-13", 0], ["2020-03-14", 0], ["2020-03-15", 0], ["2020-03-16", 0], ["2020-03-17", 0], ["2020-03-18", 0], ["2020-03-19", 0], ["2020-03-20", 0], ["2020-03-21", 0], ["2020-03-22", 0], ["2020-03-23", 0], ["2020-03-24", 0], ["2020-03-25", 0], ["2020-03-26", 0], ["2020-03-27", 0], ["2020-03-28", 0], ["2020-03-29", 0], ["2020-03-30", 0], ["2020-03-31", 0], ["2020-04-01", 0], ["2020-04-02", 0], ["2020-04-03", 0], ["2020-04-04", 0], ["2020-04-05", 0], ["2020-04-06", 0], ["2020-04-07", 0], ["2020-04-08", 0], ["2020-04-09", 0], ["2020-04-10", 0], ["2020-04-11", 0], ["2020-04-12", 0], ["2020-04-13", 0], ["2020-04-14", 0], ["2020-04-15", 0], ["2020-04-16", 0], ["2020-04-17", 0], ["2020-04-18", 0], ["2020-04-19", 0], ["2020-04-20", 0], ["2020-04-21", 0], ["2020-04-22", 0], ["2020-04-23", 0], ["2020-04-24", 0], ["2020-04-25", 0], ["2020-04-26", 0], ["2020-04-27", 0], ["2020-04-28", 0], ["2020-04-29", 0], ["2020-04-30", 0], ["2020-05-01", 0], ["2020-05-02", 0], ["2020-05-03", 0], ["2020-05-04", 0], ["2020-05-05", 0], ["2020-05-06", 1], ["2020-05-07", 0], ["2020-05-08", 0], ["2020-05-09", 1], ["2020-05-10", 0], ["2020-05-11", 0], ["2020-05-12", 0], ["2020-05-13", 0], ["2020-05-14", 1], ["2020-05-15", 0], ["2020-05-16", 0], ["2020-05-17", 0], ["2020-05-18", 0], ["2020-05-19", 0], ["2020-05-20", 0], ["2020-05-21", 0], ["2020-05-22", 0], ["2020-05-23", 0], ["2020-05-24", 0], ["2020-05-25", 0], ["2020-05-26", 0], ["2020-05-27", 0], ["2020-05-28", 0], ["2020-05-29", 0], ["2020-05-30", 0], ["2020-05-31", 0], ["2020-06-01", 1], ["2020-06-02", 0], ["2020-06-03", 0], ["2020-06-04", 0], ["2020-06-05", 0], ["2020-06-06", 0], ["2020-06-07", 0], ["2020-06-08", 0], ["2020-06-09", 0], ["2020-06-10", 0], ["2020-06-11", 0], ["2020-06-12", 0], ["2020-06-13", 0], ["2020-06-14", 0], ["2020-06-15", 0], ["2020-06-16", 0], ["2020-06-17", 0], ["2020-06-18", 0], ["2020-06-19", 0], ["2020-06-20", 0], ["2020-06-21", 0], ["2020-06-22", 0], ["2020-06-23", 0], ["2020-06-24", 0], ["2020-06-25", 0], ["2020-06-26", 0], ["2020-06-27", 0], ["2020-06-28", 0], ["2020-06-29", 0], ["2020-06-30", 0], ["2020-07-01", 0], ["2020-07-02", 0], ["2020-07-03", 0], ["2020-07-04", 0], ["2020-07-05", 0], ["2020-07-06", 0], ["2020-07-07", 0], ["2020-07-08", 0], ["2020-07-09", 0], ["2020-07-10", 0], ["2020-07-11", 0], ["2020-07-12", 0], ["2020-07-13", 0], ["2020-07-14", 0], ["2020-07-15", 0], ["2020-07-16", 0], ["2020-07-17", 0], ["2020-07-18", 0], ["2020-07-19", 0], ["2020-07-20", 0], ["2020-07-21", 0], ["2020-07-22", 0], ["2020-07-23", 0], ["2020-07-24", 0], ["2020-07-25", 0], ["2020-07-26", 0], ["2020-07-27", 0], ["2020-07-28", 0], ["2020-07-29", 0], ["2020-07-30", 0], ["2020-07-31", 0], ["2020-08-01", 1], ["2020-08-02", 1], ["2020-08-03", 1], ["2020-08-04", 1], ["2020-08-05", 1], ["2020-08-06", 1], ["2020-08-07", 0], ["2020-08-08", 0], ["2020-08-09", 0], ["2020-08-10", 0], ["2020-08-11", 1], ["2020-08-12", 1], ["2020-08-13", 1], ["2020-08-14", 1], ["2020-08-15", 0], ["2020-08-16", 0]]
        }]

    };

    myChart.setOption(option);
</script>
  <footer class="clearfix">

    <br><br>
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="https://www.jianshu.com/u/400aba58cff5"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="/t871640073@qq.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/Sevenven777"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        Use
        <a href="https://volantis.js.org/" target="_blank" class="codename">Volantis</a>
        as theme, total visits
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          times
        
      
    
      
        <div class='copyright'>
        <p><a href="https://xaoxuu.com" target="_blank" rel="noopener">Copyright © 2017-2020 Mr. X</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>


  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '8px',
        duration: '800',
        interval: '100',
        scale: '1'
      });
    });
  </script>


  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/B18FCBB3-67FD-48CC-B4F3-457BA145F17A.jpeg", "https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/67239FBB-E15D-4F4F-8EE8-0F1C9F3C4E7C.jpeg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/016.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('') {
          $('').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  









  
    
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var meta = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick','mail','link'];
  var requiredFields = 'nick,mail'.split(',').filter(function(item){
    return REQUIRED_FIELDS.indexOf(item) > -1
  });
  var valine = new Valine();
  function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  valine.init({
    el: '#valine_container',
    meta: meta,
    
    appId: "dogUA2FSKGTo029M1SEwGROT-MdYXbMMI",
    appKey: "u0NdtQ8nvHoMdJPSYqm1LRxE",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'robohash',
    lang:'zh-cn',
    visitor: 'true',
    highlight: 'true',
    mathJax: 'false',
    enableQQ: 'true',
    requiredFields: requiredFields,
    emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
    emojiMaps: emojiMaps
  })
  </script>





  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.6.5/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>






<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-check-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-check-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-times-circle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('fa-times-circle');
          $icon.addClass('fa-copy');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    let LAZY_LOAD_IMAGE = "";
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      if (LAZY_LOAD_IMAGE == true) {
        $(element).attr("href", $(this).attr("data-original"));
      } else {
        $(element).attr("href", $(this).attr("src"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 标准 markdown 描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>




  <script>setLoadingBarProgress(100);</script>

  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
